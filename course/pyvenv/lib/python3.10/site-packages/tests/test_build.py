import it4kt
from it4kt.build import Builder, LatexBuilder


def test_read_course_has_title(example_course):
    course = Builder().read_course()
    assert course.title == 'Názov predmetu'


def test_read_course_has_links(example_course):
    course = Builder().read_course()
    assert course.links[0].title == 'KPI'
    assert course.links[0].url == 'https://kpi.fei.tuke.sk/'


def test_build_course_produces_right_structure(i18n_course):
    Builder().build()
    assert (it4kt.env.output_dir / 'index.html').exists()
    assert (it4kt.env.output_dir / 'en' / 'index.html').exists()
    assert (it4kt.env.output_dir / 'ru' / 'index.html').exists()
    assert (it4kt.env.output_dir / 'lecturer' / 'index.html').exists()
    assert (it4kt.env.output_dir / 'lecturer' / 'en' / 'index.html').exists()
    assert (it4kt.env.output_dir / 'lecturer' / 'ru' / 'index.html').exists()


class TestLatexBuilder:
    def test_main_contains_imports(self, example_course):
        LatexBuilder(['sk'], None).build()
        main_file = it4kt.env.output_dir / 'article.tex'
        assert main_file.exists()
        text = main_file.read_text(encoding='utf-8')
        assert "\\input{index}" in text
        assert "\\input{labs/01}" in text

    def test_chapter_contains_text(self, example_course):
        LatexBuilder(['sk'], None).build()
        lab_file = it4kt.env.output_dir / 'labs/01.tex'
        assert lab_file.exists()
        text = lab_file.read_text(encoding='utf-8')
        assert "Prvé cvičenie" in text
        assert "Ciele" in text
        assert "Úvod" in text
        assert "Krok" in text

    def test_images_copied(self, example_course):
        LatexBuilder(['sk'], None).build()
        image_file = it4kt.env.output_dir / 'labs/images/example-image.svg'
        assert image_file.exists()
