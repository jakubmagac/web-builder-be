<?xml version="1.0" encoding="utf-8"?>

<xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
                xmlns:p="http://kpi.fei.tuke.sk/practices" version="1.0">

    <xsl:import href="content.xsl"/>

    <xsl:output method="html" omit-xml-declaration="yes"/>

    <!-- =============================== module ============================= -->
    <!-- Main tamplate for module -->
    <!--<xsl:variable name="english" select="contains(tokenize(document-uri(.), '/')[last()-1], '-en')"/>
    <xsl:variable name="slovak" select="not($english)"/>-->

    <xsl:template match="p:subjectInfo">
    <div class="page-content">
        <section class="section section--objectives">
            <h2 class="section__header">
                <xsl:value-of select="$lang.subject-objectives"/>
            </h2>
            <ol class="objectives">
                <xsl:apply-templates select="p:objective"/>
            </ol>
        </section>

        <section class="section section--additional-info">
            <h2 class="section__header">
                <xsl:value-of select="$lang.additional-information"/>
            </h2>
            <xsl:apply-templates select="p:additionalInfo"/>
        </section>

        <section class="section section--conditions">
            <h2 class="section__header">
                <xsl:value-of select="$lang.credit-conditions"/>
            </h2>
            <ul>
                <xsl:apply-templates select="p:conditions"/>
            </ul>
        </section>

        <!--TODO: dorobit to zeby neostavali nadpisy pri nepovinnych poliach!!!!!-->
        <section class="section section--teachers">
            <h2 class="section__header">
                <xsl:value-of select="$lang.teachers"/>
            </h2>

        <h3 class="presenter">
            <xsl:value-of select="$lang.presenters"/>
        </h3>
        <ul>
            <xsl:apply-templates select="p:presenter"/>
        </ul>
        <h3 class="instructor">
            <xsl:value-of select="$lang.instructors"/>
        </h3>
        <ul>
            <xsl:apply-templates select="p:instructor"/>
        </ul>
        </section>

        <xsl:if test="count(p:lecture) > 0">
            <section class="section section--lecture">
                <h2 class="section__header">
                    <xsl:value-of select="$lang.lectures"/>
                </h2>

                <ul>
                    <xsl:apply-templates select="p:lecture"/>
                </ul>
            </section>
        </xsl:if>

        <xsl:if test="count(p:resource) > 0">
            <section class="section section--resources">
                <h2 class="section__header">
                    <xsl:value-of select="$lang.resources"/>
                </h2>
                <ol class="resources-ol">
                    <xsl:apply-templates select="p:resource"/>
                </ol>
            </section>
        </xsl:if>
    </div>
    </xsl:template>

    <!-- Objective -->
    <xsl:template match="p:objective">
        <li class="objective">
            <xsl:apply-templates/>
        </li>
    </xsl:template>

<!-- ======================= introduction ======================== -->
    <xsl:template match="p:additionalInfo">
        <xsl:apply-templates/>
    </xsl:template>

<!-- ======================= conditions ======================== -->
    <xsl:template match="p:conditions">
        <xsl:if test="@generatePresenceConditions='true'">
            <li>
                <xsl:value-of select="$lang.none-unexcused-absence"/>
            </li>
            <li>
                <xsl:value-of select="$lang.max-3-excused-absences"/>
            </li>
        </xsl:if>
        <xsl:apply-templates select="p:scores"/>
        <xsl:apply-templates select="p:assignments"/>
    </xsl:template>

    <xsl:template match="p:scores">
        <li>
            <xsl:value-of select="$lang.min-credit-1"/>
            <b>
                <xsl:apply-templates select="p:min"/>
                <xsl:value-of select="$lang.min-credit-2"/>
                <xsl:apply-templates select="p:max"/>
            </b>
            <xsl:value-of select="$lang.min-credit-3"/>
        </li>
    </xsl:template>

    <xsl:template match="p:assignments">
        <xsl:apply-templates select="p:assignment"/>
    </xsl:template>

    <xsl:template match="p:assignment">
        <xsl:variable name="assignmentNameAkuzativ">
            <xsl:if test="not(@type) or @type='undefined' or @type='program' or @type='document'"><xsl:value-of select="$lang.assignment-akuzativ"/></xsl:if>
            <xsl:if test="@type = 'test'"><xsl:value-of select="$lang.test-akuzativ"/></xsl:if>
            <xsl:if test="@type = 'exam'"><xsl:value-of select="$lang.exam-akuzativ"/></xsl:if>
            <xsl:if test="@type = 'presentation'"><xsl:value-of select="$lang.presentation-akuzativ"/></xsl:if>
            <xsl:if test="@type = 'activity'"><xsl:value-of select="$lang.activity-akuzativ"/></xsl:if>
        </xsl:variable>

        <li>
            <xsl:apply-templates/>
            <xsl:if test="@type='test'">
                <xsl:value-of select="$lang.test-1"/>
                <xsl:value-of select="@week"/>
                <xsl:value-of select="$lang.test-2"/>
            </xsl:if>
            <xsl:if test="@type='exam'">
                <xsl:value-of select="$lang.exam-1"/>
                <xsl:value-of select="@week"/>
                <xsl:value-of select="$lang.exam-2"/>
            </xsl:if>
            <xsl:if test="@type='program' or @type='document'">
                <xsl:value-of select="$lang.program-1"/>
                <xsl:value-of select="@week"/>
                <xsl:value-of select="$lang.program-2"/>
            </xsl:if>
            <xsl:if test="@type='presentation'">
                <xsl:value-of select="$lang.presentation-1"/>
                <xsl:value-of select="@week"/>
                <xsl:value-of select="$lang.presentation-2"/>
            </xsl:if>
            <xsl:if test="@type='activity' and not(@maxPoints)">
                <xsl:value-of select="$lang.activity"/>
            </xsl:if>
            <xsl:if test="@type='undefined'">
                <!-- Undefined bude vyplnene len ak boli pouzite @week a @maxPoints -->
                <xsl:if test="@maxPoints">
                    <xsl:value-of select="$lang.undefined-maxpoints-1"/>
                    <xsl:value-of select="@maxPoints"/>
                    <xsl:value-of select="$lang.undefined-maxpoints-2"/>
                </xsl:if>
                <xsl:if test="@week">
                    <xsl:value-of select="$lang.undefined-week-1"/>
                    <xsl:value-of select="@week"/>
                    <xsl:value-of select="$lang.undefined-week-2"/>
                </xsl:if>
            </xsl:if>
            <xsl:if test="@maxPoints">
                <xsl:value-of select="$lang.max-points-1"/>
                <xsl:value-of select="$assignmentNameAkuzativ"/>
                <xsl:value-of select="$lang.max-points-2"/>
                <b><xsl:value-of select="@maxPoints"/></b>
                <xsl:value-of select="$lang.max-points-3"/>
            </xsl:if>
        </li>
    </xsl:template>

    <xsl:template match="p:presenter">
        <li>
            <xsl:call-template name="teacher"/>
        </li>
    </xsl:template>

    <xsl:template match="p:instructor">
        <li>
            <xsl:call-template name="teacher"/>
        </li>
    </xsl:template>

    <xsl:template match="p:lecture">
        <li style="padding-bottom:5px;">
            <xsl:call-template name="lecture"/>
        </li>
    </xsl:template>

    <xsl:template name="teacher">
        <!--<xsl:variable name="pathParts" select="tokenize(base-uri(),'/')" />-->
        <!--<xsl:variable name="subjectName" select="$pathParts[count($pathParts)-1]" />-->
        <xsl:choose>
            <xsl:when test="count(p:url)">
                <a><xsl:attribute name="href"><xsl:value-of select="p:url"/></xsl:attribute><xsl:value-of select="p:name"/></a>
            </xsl:when>
            <xsl:otherwise><xsl:value-of select="p:name"/></xsl:otherwise>
        </xsl:choose>
        <xsl:if test="count(p:contact)">, <a><xsl:attribute name="href">mailto:<xsl:value-of select="p:contact"/></xsl:attribute><xsl:value-of select="$lang.contact"/></a></xsl:if>
    </xsl:template>

    <xsl:template name="lecture">
        <xsl:value-of select="p:when"/>,
        <xsl:value-of select="p:where"/><br/>
        <small><xsl:value-of select="p:who"/></small>
    </xsl:template>

    <!-- ======================= resource ======================== -->
    <xsl:template match="p:resource">
        <li class="resource">
            <xsl:apply-templates/>
        </li>
    </xsl:template>
</xsl:stylesheet>
